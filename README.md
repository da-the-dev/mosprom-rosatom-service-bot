# Агентная система для обработки обращений в техподдержку

*красивая картинка-логотип сюда, или вообще презу уаткнуть*

## Информация по кейсу

- Кейсодатель: Росатом
- Кейсодержатель: TODO

## Разработчики
- [Алексей Ткаченко](https://github.com/da-the-dev/)
- [Вера Краснобаева](https://github.com/Vera-bahval)
- [Григорий Мацнев](https://github.com/pe51k)
- [Яков Марченков](https://github.com/RipYashok)

## Описание 
### Проблематика
Неизбежно в больших компаниях в возникает проблема разрозненности информационных сервисов. Информации становится все больше, искать нужно все сложнее. Компании содержать дорогие линии поддержки, но их сложно масштабиривать. Такой способ приводит к низкому качеству обработки запросов пользователей: по нашим подсчетам, в среднем в бигтехе **уходит в среднем 4 сообщения для решения 1 вопроса**.

### Последствия
- Долгое ожидание из-за пиков/нагрузки *(пики в ~11:00, после обеда и в конце рабочего дня)*
- Ошибочная маршрутизация между группами, из-за чего силы специалистов могут тратиться на задачи не из их экспертного поля
- Рутинные повторяющиеся операции, которые можно было бы автоматизировать
- Разрозненные знания, устаревшие/дублирующиеся статьи
- Слабая аналитика, не выявляются причины/не прогнозируются всплески

### Цель
TODO

### Решение
- Пользовательский опыт с нашим решением (UX future)
- Автоприём и классификация обращения
- Мгновенный поиск ответа и/или запуск типовых действий (сброс пароля, доступ)
- Прозрачный статус: «решено автоматически» или эскалация при низкой уверенности
- Ответ в удобном канале (почта/чат/портал), персонализация по роли/истории
- Система учится на кейсах, формирует отчёты и метрики качества

### Системный дизайн

![Системный дизайн](./assests/system_design.png "Системный дизайн")  


## Аналитика

Мы проанализировали датасет с примерами обращений и выделили следующие ключевые темы

![Темы](./assests/topics.png "Темы") 

При этом некоторые из тем насколько глубоки и обширны, что требуют оркестрации AI-агентов.

### Разработанные агенты

```
┌─────────────────────────┐
│ Smart Orchestration     │──┐
│ Router [tool_output]    │  │
└─────────────────────────┘  │
┌─────────────────────────┐  │
│ Processing Monitor      │──┤
│ Tool [tool_output]      │  │
└─────────────────────────┘  │
┌─────────────────────────┐  │
│ Classify Request        │──┤
│ Tool [tool_output]      │  │
└─────────────────────────┘  ├──► ┌──────────┐
┌─────────────────────────┐  │    │  AGENT   │
│ Knowledge Base Search   │──┤    │ [tools]  │
│ Tool [tool_output]      │  │    └──────────┘
└─────────────────────────┘  │
┌─────────────────────────┐  │
│ Other Tools...          │──┘
└─────────────────────────┘
```
- **Smart Orchestration Router** - маршрутизация к специализированным handlers
- **Processing Monitor** - real-time мониторинг микросервисов
- Используются только для новых вопросов, пропускаются для уточнений

**Основные компоненты**

**1. Agent (Tool Calling Agent)**

- LLM: YandexGPT через OpenAI-compatible API
- Роль: Центральный оркестратор, принимающий решения о выборе инструментов
- Функции: Анализ запросов, выбор стратегии обработки, формирование ответов
  
**2. Knowledge Base Search Tool**

- Технологии: Qdrant (векторная БД) + Yandex Embeddings
- Функция: Семантический поиск ответов в корпоративной базе знаний
- Особенности:
  
    - Поиск по QA парам с метаданными
    - Оценка релевантности результатов
    - Фильтрация по категориям
  
**3. Classification Tool**

- Функция: Автоматическая классификация обращений
- Категории:
  
  - HR_PROCESS (кадровые вопросы)
  - EMPLOYEE_INFO (информация о сотруднике)
  - REQUEST_CREATE (создание заявок)
  - REQUEST_STATUS (проверка статуса)
  - SYSTEM_ACTION (выполнение действий)
  - TECHNICAL (технические вопросы)
  - POLICY (политики компании)
  - GENERAL (общие вопросы)
  
**4. Employee Info Tool**

- Функция: Получение информации о сотруднике из HR системы
- Данные: Должность, отдел, график работы, остаток отпуска, выплаты
  
**5. Request Management Tools**

- Create Request: Создание заявок (отпуск, больничный, справки и т.д.)
- Check Request Status: Отслеживание статуса заявок с визуализацией прогресса
  
**6. System Action Tool**

- Функция: Выполнение действий в корпоративных системах
- Действия: Сброс пароля, предоставление доступа, разблокировка аккаунтов
- Безопасность: Требует подтверждения пользователя перед выполнением
  
**7. Escalation Tool**

- Функция: Передача обращения человеку-оператору
- Триггеры: Низкая уверенность (<60%), явный запрос пользователя, нестандартные ситуации
  
**8. Toxicity Check Tool**

- Функция: Проверка безопасности контента перед отправкой
- Применение: Валидация всех исходящих сообщений
  
**9. URL Search Tool**

- Функция: Поиск информации во внешних источниках
- Применение: Когда информации нет в корпоративной базе
  
## Как с этим работать
### Как запустить
Для начала сгенерируйте ключи, пароли и прочие секреты:
```bash
$ ./generate-creds.sh > .env
```

Теперь просто поднимаем все контейнеры:
```bash
$ docker compose up -d
```

### Как зайти
В Docker compose поднимаются ключевые сервисы на следующих портах:
- `:7860` - веб-интефейс Lang*flow*
- `:3000` - веб-интефейс Lang*fuse*

Интерфейс Lang*flow* не требует авторизации

Интерфейс Lang*fuse* требует авторизации. Посмотрите `.env` и найдите переменные ниже. По умолчанию создается учетная запись с этими данными:
```env
LANGFUSE_INIT_USER_EMAIL=langfuse-admin@rosatom.ru
LANGFUSE_INIT_USER_PASSWORD=<пароль>
```

### Описания файлов
| Файл                                                         | Описание                                                            |
| ------------------------------------------------------------ | ------------------------------------------------------------------- |
| [docker-compose.yaml](docker-compose.yaml)                   | Основной файл, который импортирует настройки для остальных сервисов |
| [langflow-docker-compose.yaml](langflow-docker-compose.yaml) | Описания сервисов Langflow                                          |
| [langfuse-docker-compose.yaml](langfuse-docker-compose.yaml) | Описания сервисов Langfuse                                          |
| [generate-creds.sh](generate-creds.sh)                       | Скрипт для генерации переменных окружения (пароли и секреты)        |
| [assets/](assets/)                                           | Папка с файлами для README.md и презентаций                         |
